<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLUSFLIX - Ulubione filmy</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="font-medium">
    <a href="#main-content" class="skip-to-content">Przejdź do treści</a>

    <header class="header" role="banner">
        <div class="container">
            <div class="header-content">
                <div class="logo" onclick="location.href='index.html'" role="button" tabindex="0" aria-label="PLUSFLIX - Strona główna">
                    <div class="logo-icon" aria-hidden="true">
                        <i class="fas fa-play"></i>
                    </div>
                    <h1>PLUSFLIX</h1>
                </div>

                <nav class="main-nav" role="navigation" aria-label="Główne menu">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i> Strona główna
                    </a>
                    <a href="ulubione.html" class="nav-link active">
                        <i class="fas fa-heart"></i> Ulubione
                    </a>
                    <a href="czaty.html" class="nav-link">
                        <i class="fas fa-comments"></i> Czaty
                    </a>
                </nav>

                <div class="search-section">
                    <div class="search-wrapper">
                        <div class="search-icon" aria-hidden="true">
                            <i class="fas fa-search"></i>
                        </div>
                        <input type="text" 
                               class="search-input" 
                               placeholder="Wyszukaj w ulubionych..."
                               aria-label="Wyszukaj w ulubionych"
                               id="search-input">
                        <button class="clear-btn" onclick="clearSearch()" aria-label="Wyczyść wyszukiwanie">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <div class="header-actions">
                    <div class="font-size-control" aria-label="Zmiana rozmiaru czcionki">
                        <button class="font-btn" onclick="setFontSize('small')" aria-label="Mała czcionka">A-</button>
                        <button class="font-btn active" onclick="setFontSize('medium')" aria-label="Średnia czcionka">A</button>
                        <button class="font-btn" onclick="setFontSize('large')" aria-label="Duża czcionka">A+</button>
                    </div>
                    <button class="admin-btn" onclick="location.href='admin.html'" aria-label="Panel administratora">
                        <i class="fas fa-user-cog"></i> Admin
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main id="main-content" class="container" role="main">
        <section class="page-content active">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-heart"></i> Twoje ulubione filmy
                </h2>
                <div class="section-actions">
                    <span class="results-count">Znaleziono <span id="favorites-count">0</span> filmów</span>
                    <button class="secondary-btn" onclick="clearFavorites()" aria-label="Wyczyść ulubione">
                        <i class="fas fa-trash"></i> Wyczyść listę
                    </button>
                    <button class="primary-btn" onclick="exportFavorites()" aria-label="Eksportuj ulubione">
                        <i class="fas fa-download"></i> Eksportuj
                    </button>
                </div>
            </div>

            <div class="favorites-search">
                <div class="search-wrapper">
                    <div class="search-icon" aria-hidden="true">
                        <i class="fas fa-search"></i>
                    </div>
                    <input type="text" 
                           class="search-input" 
                           placeholder="Wyszukaj w ulubionych..."
                           aria-label="Wyszukaj w ulubionych"
                           id="favorites-search"
                           oninput="searchFavorites()">
                </div>
            </div>

            <div id="favorites-grid" class="movies-grid">
                <!-- Ulubione filmy będą ładowane dynamicznie -->
            </div>

            <div id="favorites-empty" class="favorites-empty" style="display: none;">
                <div class="favorites-empty-icon">
                    <i class="fas fa-heart-broken"></i>
                </div>
                <h3 class="favorites-empty-text">Brak ulubionych filmów</h3>
                <p class="favorites-empty-subtext">Dodaj filmy do ulubionych, klikając ikonę serca na karcie filmu</p>
                <button class="primary-btn" onclick="location.href='index.html'">
                    <i class="fas fa-search"></i> Przeglądaj filmy
                </button>
            </div>
        </section>
    </main>

    <div id="movie-modal" class="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
      
    </div>

    <div id="confirm-modal" class="confirm-modal" role="dialog" aria-hidden="true">
        <div class="confirm-content">
            <h3 class="confirm-title" id="confirm-title"></h3>
            <p class="confirm-message" id="confirm-message"></p>
            <div class="confirm-buttons">
                <button class="secondary-btn" id="confirm-cancel">
                    <i class="fas fa-times"></i> Anuluj
                </button>
                <button class="primary-btn" id="confirm-ok">
                    <i class="fas fa-check"></i> Potwierdź
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadFavorites();
            document.getElementById('favorites-search').addEventListener('input', searchFavorites);
        });

        function loadFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            const grid = document.getElementById('favorites-grid');
            const empty = document.getElementById('favorites-empty');
            const count = document.getElementById('favorites-count');

            if (favorites.length === 0) {
                grid.style.display = 'none';
                empty.style.display = 'block';
                count.textContent = '0';
                return;
            }

            grid.style.display = 'grid';
            empty.style.display = 'none';
            count.textContent = favorites.length;

            grid.innerHTML = favorites.map(movie => `
                <div class="movie-card is-favorite" data-id="${movie.id}" onclick="openMovieModal(${movie.id})">
                    <div class="favorite-indicator">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="movie-poster">
                        <img src="${movie.poster || 'https://via.placeholder.com/300x450?text=Brak+plakatu'}" alt="${movie.title}">
                        <div class="movie-overlay">
                            <div class="overlay-actions">
                                <button class="overlay-btn favorited" onclick="event.stopPropagation(); toggleFavorite(${movie.id})" aria-label="Usuń z ulubionych">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button class="overlay-btn" onclick="event.stopPropagation(); shareMovie(${movie.id})" aria-label="Udostępnij">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="rating-badge">
                            <i class="fas fa-star"></i>
                            <span>${movie.rating || 'N/A'}</span>
                        </div>
                        <div class="streaming-services">
                            ${(movie.platforms || []).slice(0, 2).map(platform => `
                                <span class="service-badge ${platform}">${getPlatformIcon(platform)}</span>
                            `).join('')}
                        </div>
                    </div>
                    <div class="movie-info">
                        <h3 class="movie-title">${movie.title}</h3>
                        <div class="movie-meta">
                            <span class="movie-year">${movie.year || 'N/A'}</span>
                            <span class="movie-genre">${(movie.genres || []).slice(0, 2).join(', ')}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function searchFavorites() {
            const searchTerm = document.getElementById('favorites-search').value.toLowerCase();
            const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            const grid = document.getElementById('favorites-grid');

            if (!searchTerm.trim()) {
                loadFavorites();
                return;
            }

            const filtered = favorites.filter(movie => 
                movie.title.toLowerCase().includes(searchTerm) ||
                (movie.genres && movie.genres.some(g => g.toLowerCase().includes(searchTerm)))
            );

            const count = document.getElementById('favorites-count');
            count.textContent = filtered.length;

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="no-results" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <div class="no-results-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3 class="no-results-text">Nie znaleziono filmów</h3>
                        <p class="no-results-subtext">Spróbuj zmienić kryteria wyszukiwania</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(movie => `
                <div class="movie-card is-favorite" data-id="${movie.id}" onclick="openMovieModal(${movie.id})">
                    <div class="favorite-indicator">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="movie-poster">
                        <img src="${movie.poster || 'https://via.placeholder.com/300x450?text=Brak+plakatu'}" alt="${movie.title}">
                        <div class="movie-overlay">
                            <div class="overlay-actions">
                                <button class="overlay-btn favorited" onclick="event.stopPropagation(); toggleFavorite(${movie.id})" aria-label="Usuń z ulubionych">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <button class="overlay-btn" onclick="event.stopPropagation(); shareMovie(${movie.id})" aria-label="Udostępnij">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="rating-badge">
                            <i class="fas fa-star"></i>
                            <span>${movie.rating || 'N/A'}</span>
                        </div>
                        <div class="streaming-services">
                            ${(movie.platforms || []).slice(0, 2).map(platform => `
                                <span class="service-badge ${platform}">${getPlatformIcon(platform)}</span>
                            `).join('')}
                        </div>
                    </div>
                    <div class="movie-info">
                        <h3 class="movie-title">${movie.title}</h3>
                        <div class="movie-meta">
                            <span class="movie-year">${movie.year || 'N/A'}</span>
                            <span class="movie-genre">${(movie.genres || []).slice(0, 2).join(', ')}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function clearFavorites() {
            showConfirmModal(
                'Wyczyść ulubione',
                'Czy na pewno chcesz usunąć wszystkie filmy z listy ulubionych? Ta operacja jest nieodwracalna.',
                function() {
                    localStorage.removeItem('favorites');
                    loadFavorites();
                }
            );
        }

        function exportFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            if (favorites.length === 0) {
                alert('Brak ulubionych filmów do eksportu.');
                return;
            }

            const dataStr = JSON.stringify(favorites, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = 'ulubione-filmy.json';

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function getPlatformIcon(platform) {
            const icons = {
                'netflix': '<i class="fab fa-netflix"></i>',
                'hbo': '<i class="fas fa-tv"></i>',
                'disney': '<i class="fab fa-disney"></i>',
                'amazon': '<i class="fab fa-amazon"></i>',
                'apple': '<i class="fab fa-apple"></i>'
            };
            return icons[platform] || platform;
        }
    </script>
</body>
</html>